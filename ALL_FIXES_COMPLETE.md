# ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´

**–î–∞—Ç–∞:** 15 –¥–µ–∫–∞–±—Ä—è 2024  
**User:** 971025595

---

## üéâ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ Subscription Service
- –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `"active"`
- `visits_remaining` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ø–ª–∞–Ω–∞
- `is_unlimited` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ø–ª–∞–Ω–∞

### 2. ‚úÖ Visit Service  
- –ú–æ–¥–µ–ª—å Subscription –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ `visits_remaining` –∏ `is_unlimited`
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–∏–∑–∏—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 3. ‚úÖ Frontend URLs
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã
- Subscription API: `http://localhost:8002`
- Visit API: `http://localhost:8004`

### 4. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É subscriptions
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É subscription_plans
- –°–æ–∑–¥–∞–Ω—ã –ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–æ–∫ (–ë–∞–∑–æ–≤—ã–π, –°—Ç–∞–Ω–¥–∞—Ä—Ç, –ü—Ä–µ–º–∏—É–º)

### 5. ‚úÖ User App
- –ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å backend
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- QR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 6. ‚úÖ Schemas
- SubscriptionResponse –≤–∫–ª—é—á–∞–µ—Ç `visits_remaining`
- SubscriptionResponse –≤–∫–ª—é—á–∞–µ—Ç `is_unlimited`

---

## üìã –ü–æ–ª–Ω—ã–π Flow

```
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí POST /api/user/users
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω

2. –õ–æ–≥–∏–Ω ‚Üí POST /api/user/auth/login  
   ‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω

3. –í—ã–±–æ—Ä –ø–ª–∞–Ω–∞ ‚Üí POST http://localhost:8002/subscriptions
   ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –ë–î
   ‚úÖ status = "active"
   ‚úÖ visits_remaining = 10

4. –ì–ª–∞–≤–Ω–∞—è ‚Üí GET http://localhost:8002/subscriptions/status
   ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
   ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–û—Å—Ç–∞–ª–æ—Å—å –≤–∏–∑–∏—Ç–æ–≤: 10"

5. QR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí POST http://localhost:8004/user-checkin
   ‚úÖ –í–∏–∑–∏—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
   ‚úÖ visits_remaining = 9
   ‚úÖ –í–∏–∑–∏—Ç –≤ –ë–î

6. –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ ‚Üí GET http://localhost:8004/visits?user_id=...
   ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–∏–∑–∏—Ç—ã
```

---

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend
```
‚úÖ backend/shared/models.py
   - –î–æ–±–∞–≤–ª–µ–Ω—ã visits_remaining, is_unlimited

‚úÖ backend/shared/schemas.py
   - SubscriptionResponse –æ–±–Ω–æ–≤–ª–µ–Ω–∞

‚úÖ backend/services/subscription/main.py
   - status="active"
   - visits_remaining —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

‚úÖ backend/services/visit/main.py
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç visits_remaining
```

### Frontend
```
‚úÖ frontend/user-app/src/pages/HomePremium.js
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —Å backend
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ visits_remaining

‚úÖ frontend/user-app/src/pages/SubscriptionsPremium.js
   - API –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 8002
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ë–î

‚úÖ frontend/user-app/src/pages/QRScannerCamera.js
   - API –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 8004
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ visits_remaining

‚úÖ frontend/user-app/src/pages/VisitHistory.js
   - –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –≤–∏–∑–∏—Ç–æ–≤
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å backend
```

### Database
```
‚úÖ subscriptions table
   - visits_remaining column
   - is_unlimited column

‚úÖ subscription_plans table
   - 3 –ø–ª–∞–Ω–∞ —Å–æ–∑–¥–∞–Ω—ã
```

---

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ User App
```
http://localhost:3003
```

### 2. –í–æ–π–¥–∏—Ç–µ
```
Phone: +998971025595
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–ª–∞–≤–Ω—É—é
```
‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚úÖ "–û—Å—Ç–∞–ª–æ—Å—å –≤–∏–∑–∏—Ç–æ–≤: 9"
‚úÖ "–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: 30"
```

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –≤–∏–∑–∏—Ç–æ–≤
```
http://localhost:3003/visits
‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∏–∑–∏—Ç
‚úÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
‚úÖ –°—Ç–∞—Ç—É—Å: –ó–∞–≤–µ—Ä—à–µ–Ω
```

### 5. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR
```
http://localhost:3003/qr
MERCHANT_452f6116-fb1e-43ce-b9b8-1060cfdaa6b3_...
‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
‚úÖ –í–∏–∑–∏—Ç—ã: 9 ‚Üí 8
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω
- ‚úÖ –í—ã–±–æ—Ä –ø–ª–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –≤ –ë–î
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤
- ‚úÖ QR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤
- ‚úÖ –ü–æ—Å–ª–µ logout –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç

**–ì–æ—Ç–æ–≤–æ! üéâ**

---

**–ê–≤—Ç–æ—Ä:** Cascade AI  
**–î–∞—Ç–∞:** 15 –¥–µ–∫–∞–±—Ä—è 2024
